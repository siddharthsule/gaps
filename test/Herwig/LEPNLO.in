# -*- ThePEG-repository -*-

##################################################
# Example generator based on LEP parameters
# usage: Herwig read LEPNLO.in
##################################################

read snippets/Matchbox.in
read snippets/EECollider.in

##################################################
# Technical parameters for this run
##################################################

cd /Herwig/Generators
set EventGenerator:EventHandler:LuminosityFunction:Energy 91.2*GeV

##################################################
# Matrix Elements for e-e collisions 
# (by default only gamma/Z switched on)
##################################################

## Model assumptions
read Matchbox/StandardModelLike.in
read Matchbox/DiagonalCKM.in
#read Matchbox/MCatNLO-DipoleShower.in # Additional Tune here - Do Manually!

## Set the order of the couplings
cd /Herwig/MatrixElements/Matchbox
set Factory:OrderInAlphaS 0
set Factory:OrderInAlphaEW 2
set Factory:SpinCorrelations No
set Factory:ShowerApproximation DipoleMatching
set /Herwig/EventHandlers/EventHandler:Weighted Yes
set /Herwig/Couplings/NLOAlphaS:input_scale 91.1876*GeV
set /Herwig/Couplings/NLOAlphaS:input_alpha_s 0.118
set /Herwig/Model:QCD/RunningAlphaS /Herwig/Couplings/NLOAlphaS

## Select the process
do Factory:Process e- e+ -> j j

# Set the scale
cd /Herwig/MatrixElements/Matchbox
set Factory:ScaleChoice /Herwig/MatrixElements/Matchbox/Scales/SHatScale

##################################################
#  Switch off QED Radiation
##################################################
set /Herwig/Particles/e-:PDF /Herwig/Partons/NoPDF
set /Herwig/Particles/e+:PDF /Herwig/Partons/NoPDF

##################################################
# No MPI, Decays or Hadronization
##################################################
cd /Herwig/EventHandlers
set EventHandler:CascadeHandler:MPIHandler NULL
set EventHandler:DecayHandler NULL
set EventHandler:HadronizationHandler NULL

##################################################
# Massless Quarks and AntiQuarks
##################################################
# Disable Quark Warning
cd /Herwig/Analysis
set Basics:CheckQuark No

set /Herwig/Particles/u:NominalMass 0.*GeV
set /Herwig/Particles/ubar:NominalMass 0.*GeV
set /Herwig/Particles/d:NominalMass 0.*GeV
set /Herwig/Particles/dbar:NominalMass 0.*GeV
set /Herwig/Particles/c:NominalMass 0.*GeV
set /Herwig/Particles/cbar:NominalMass 0.*GeV
set /Herwig/Particles/s:NominalMass 0.*GeV
set /Herwig/Particles/sbar:NominalMass 0.*GeV
set /Herwig/Particles/b:NominalMass 0.*GeV
set /Herwig/Particles/bbar:NominalMass 0.*GeV

##################################################
# PDFs - Not Needed for LEP
##################################################
# set /Herwig/Partons/HardLOPDF:PDFName CT14lo
# set /Herwig/Partons/HardNLOPDF:PDFName CT14nlo
# set /Herwig/Partons/ShowerLOPDF:PDFName CT14lo
# set /Herwig/Partons/ShowerNLOPDF:PDFName CT14nlo
# set /Herwig/Partons/MPIPDF:PDFName CT14lo
# set /Herwig/Partons/RemnantPDF:PDFName CT14lo

##################################################
## Shower and scheme selection.
## Should be empty unless using the Dipole Shower.
##################################################

# Set the shower to the dipole shower
cd /Herwig/Generators
set EventGenerator:EventHandler:CascadeHandler /Herwig/DipoleShower/DipoleShowerHandler

# No Spin Correlations
set /Herwig/DipoleShower/DipoleShowerHandler:SpinCorrelations No

# Alpha S Settings
set /Herwig/DipoleShower/DipoleShowerHandler:GlobalAlphaS:input_alpha_s 0.118
set /Herwig/DipoleShower/DipoleShowerHandler:GlobalAlphaS:input_scale 91.1876*GeV

# No MPI
set /Herwig/DipoleShower/DipoleShowerHandler:MPIHandler NULL

# No non-perturbative corrections
set /Herwig/DipoleShower/DipoleShowerHandler:ConstituentReshuffler NULL
set /Herwig/DipoleShower/DipoleShowerHandler:IntrinsicPtGenerator NULL

# Set all cutoffs to 1 GeV
set /Herwig/DipoleShower/Kinematics/FFLightKinematics:IRCutoff 1.0*GeV
set /Herwig/DipoleShower/Kinematics/FILightKinematics:IRCutoff 1.0*GeV
set /Herwig/DipoleShower/Kinematics/IFLightKinematics:IRCutoff 1.0*GeV
set /Herwig/DipoleShower/Kinematics/IILightKinematics:IRCutoff 1.0*GeV

# Set the scale for the shower
set /Herwig/DipoleShower/DipoleShowerHandler:MaxPtIsMuF Yes
set /Herwig/DipoleShower/DipoleShowerHandler:HardScaleProfile NULL
set /Herwig/DipoleShower/DipoleShowerHandler:DoSubleadingNc Off

# Alpha S Can be evaluated until 0 GeV
set /Herwig/DipoleShower/DipoleShowerHandler:FactorizationScaleFreeze 0.0*GeV
set /Herwig/DipoleShower/DipoleShowerHandler:RenormalizationScaleFreeze 0.0*GeV

# FF Gluon splitting - Asymmetry Option 0 (only 1/(1-z) divergence)
set /Herwig/DipoleShower/Kernels/FFgx2ggxDipoleKernel:AsymmetryOption 0

##################################################
# Shower Testing
##################################################
# set /Herwig/DipoleShower/DipoleShowerHandler:NEmissions 1
# set /Herwig/DipoleShower/DipoleShowerHandler:Verbosity 10

##################################################
## prepare for Rivet analysis or HepMC output
## when running with parton shower
##################################################
read snippets/Rivet.in
insert /Herwig/Analysis/Rivet:Analyses 0 GAPS_LEP

##################################################
# Save run for later usage with 'Herwig run'
##################################################
do /Herwig/MatrixElements/Matchbox/Factory:ProductionMode

cd /Herwig/Generators
saverun LEPNLO EventGenerator
